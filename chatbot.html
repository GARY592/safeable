<script>
const chatBox = document.getElementById('chat-box');

function appendMessage(message, sender) {
    const messageElement = document.createElement('div');
    messageElement.classList.add(sender === 'bot' ? 'bot-message' : 'user-message');
    messageElement.textContent = message;
    chatBox.appendChild(messageElement);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function speakMessage(message) {
    const utterance = new SpeechSynthesisUtterance(message);
    utterance.lang = 'en-US';
    speechSynthesis.speak(utterance);
}

function getBotResponse(userText) {
    const text = userText.toLowerCase();
    let response = "Sorry, I didn’t understand that.";

    if (text.includes("hi")) {
        response = "Hello! How can I assist you today?";
    } else if (text.includes("help")) {
        response = "I can assist you with safety tips for disasters like earthquakes, floods, cyclones, and fires. You can also ask about first aid.";
    } else if (text.includes("first aid")) {
        response = "For basic first aid: Check responsiveness, call emergency services, stop bleeding, keep the injured person comfortable, and monitor breathing.";
    } else if (text.includes("earthquake")) {
        response = "During an earthquake: Drop, cover, and hold on. Stay indoors until the shaking stops.";
    } else if (text.includes("flood")) {
        response = "In case of a flood: Move to higher ground, avoid walking/driving through floodwaters, and listen to emergency alerts.";
    } else if (text.includes("cyclone")) {
        response = "For cyclones: Stay indoors, secure windows and doors, and keep an emergency kit ready.";
    } else if (text.includes("fire")) {
        response = "If there’s a fire: Evacuate immediately, stay low to avoid smoke, and call emergency services.";
    }

    return response;
}

function sendMessage() {
    const userInput = document.getElementById('user-input');
    const userText = userInput.value.trim();
    if (userText === "") return;

    appendMessage(userText, 'user');
    userInput.value = "";

    const botResponse = getBotResponse(userText);
    appendMessage(botResponse, 'bot');
    speakMessage(botResponse);
}

function sendSuggestion(text) {
    document.getElementById('user-input').value = text;
    sendMessage();
}

function startVoiceRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("Sorry, your browser does not support voice recognition.");
        return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        appendMessage(transcript, 'user');
        const botResponse = getBotResponse(transcript);
        appendMessage(botResponse, 'bot');
        speakMessage(botResponse);
    };

    recognition.onerror = function(event) {
        alert("Voice recognition error: " + event.error);
    };
}
</script>
