<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safeable AI Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="map.html">Map</a></li>
            <li><a href="chatbot.html">AI Chatbot</a></li>
            <li><a href="contacts.html">Emergency Contacts</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>AI Chatbot</h1>
        <div id="chatbox">
            <p><strong>Bot:</strong> Hello! How can I assist you?</p>
        </div>
        <input type="text" id="userInput" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
        <button onclick="startVoiceCommand()">ðŸŽ¤ Voice Command</button>
    </div>

    <script>
        let model;

        async function loadModel() {
            model = await use.load();
            console.log("AI Model Loaded!");
        }

        async function chatbotResponse(userMessage) {
            if (!model) {
                return "AI is still loading...";
            }

            const embeddings = await model.embed([userMessage]);
            const response = generateReply(userMessage); 
            displayMessage("Bot", response);
            speak(response);
        }

        function generateReply(input) {
    input = input.toLowerCase();
    
    if (input.includes("hello")) return "Hi! How can I assist you today?";
    if (input.includes("help")) return "I can provide disaster updates, safe zone locations, and emergency contacts.";
    if (input.includes("emergency")) return "Stay calm! Should I call your emergency contact? Say 'Call Emergency' to proceed.";
    if (input.includes("earthquake")) return "If you're indoors, drop, cover, and hold on. If outside, stay away from buildings.";
    if (input.includes("flood")) return "Move to higher ground immediately. Avoid walking or driving through floodwaters.";
    if (input.includes("fire")) return "Stay low to avoid smoke. Use the nearest exit and call emergency services.";
    if (input.includes("safe zone")) return "Checking for safe zones near you... (Feature coming soon)";
    if (input.includes("show map")) {
        setTimeout(() => { window.location.href = "map.html"; }, 1000);
        return "Opening the map...";
    }
    if (input.includes("call emergency")) {
        setTimeout(() => { window.location.href = "tel:+112"; }, 1000);
        return "Calling emergency contact...";
    }
    return "I'm still learning. Can you rephrase?";
} async function translateText(text, targetLang) {
    const response = await fetch(`https://api.mymemory.translated.net/get?q=${text}&langpair=en|${targetLang}`);
    const data = await response.json();
    return data.responseData.translatedText;
}



       async function sendMessage() {
    const input = document.getElementById("userInput").value;
    if (input.trim() !== "") {
        displayMessage("You", input);
        const response = generateReply(input);
        
        // Translate chatbot's response before displaying it
        const translatedResponse = await translateText(response, "en"); // "es" = Spanish. Change to another language if needed.

        displayMessage("Bot", translatedResponse);
        document.getElementById("userInput").value = "";
    }
}

        function displayMessage(sender, text) {
            const chatbox = document.getElementById("chatbox");
            chatbox.innerHTML += `<p><strong>${sender}:</strong> ${text}</p>`;
        }

        function speak(text) {
            const speech = new SpeechSynthesisUtterance(text);
            speech.lang = "en-US";
            window.speechSynthesis.speak(speech);
        }

        function startVoiceCommand() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "en-US";
            recognition.start();

            recognition.onresult = function(event) {
                const command = event.results[0][0].transcript;
                displayMessage("You (Voice)", command);
                chatbotResponse(command);
            };
        }

        loadModel();
    </script>

</body>
</html>
