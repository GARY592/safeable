<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safeable AI Chatbot</title>
  <link rel="stylesheet" href="style.css" />
  <style> #userInput {
    height: 40px; /* Make it taller */
    font-size: 16px; /* Make text more readable */
    padding: 5px 10px; /* Add space inside */
    border-radius: 5px; /* Rounded edges */
    width: 100%; /* Make it stretch */
}
</style>
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="map.html">Map</a></li>
      <li><a href="chatbot.html">AI Chatbot</a></li>
      <li><a href="contacts.html">Emergency Contacts</a></li>
      <li><a href="settings.html">Settings</a></li>
    </ul>
  </nav>

  <div class="container" role="main" aria-labelledby="chatTitle">
    <h1 id="chatTitle">AI Chatbot</h1>

    <div id="chatbox" aria-live="polite" style="max-height: 300px; overflow:auto; border:1px solid #ddd; padding:10px; background:#fff;">
      <p><strong>Bot:</strong> Hello! How can I assist you?</p>
    </div>

    <div style="display:flex; gap:8px; margin-top:10px;">
      <input type="text" id="userInput" placeholder="Speak or type your message..." style="flex:1; padding:8px;" />
      <button id="voiceButton" aria-label="Voice input">ðŸŽ¤</button>
      <button onclick="sendMessage()">Send</button>
    </div>

    <h2>Suggestions</h2>
    <div id="suggestion-box" style="display:flex; flex-wrap:wrap; gap:8px;">
      <button onclick="setSuggestion('What should I do during an earthquake?')">During earthquake</button>
      <button onclick="setSuggestion('How do I prepare an emergency kit?')">Emergency kit</button>
      <button onclick="setSuggestion('How to perform CPR?')">CPR</button>
      <button onclick="setSuggestion('Where is the nearest shelter?')">Nearest shelter</button>
      <button onclick="setSuggestion('How to stop severe bleeding?')">Stop bleeding</button>
      <button onclick="setSuggestion('How to evacuate with a wheelchair?')">Evacuate with wheelchair</button>
      <button onclick="setSuggestion('How to purify water in an emergency?')">Purify water</button>
      <button onclick="setSuggestion('What to do during a tornado?')">During a tornado</button>
    </div>
  </div>

  <script src="voiceCommands.js" defer></script>
  <script>
    // Simple rule-based reply function
    function generateReply(input) {
      const s = (input || "").toLowerCase();
      if (s.includes("hello") || s.includes("hi")) return "Hi! How can I assist you today?";
      if (s.includes("help")) return "I can provide disaster safety tips, safe zones, and emergency contacts.";
      if (s.includes("earthquake")) return "If you're inside, drop, cover, and hold on. Move away from windows.";
      if (s.includes("flood")) return "Move to higher ground immediately. Avoid floodwater.";
      if (s.includes("fire")) return "Stay low to avoid smoke. Use the nearest exit.";
      if (s.includes("safe zone") || s.includes("shelter")) return "Check the map page for nearby safe zones. (Feature coming soon)";
      if (s.includes("call emergency")) {
        setTimeout(() => { window.location.href = "tel:+112"; }, 800);
        return "Calling emergency contact...";
      }
      if (s.includes("wheelchair")) return "If you use a wheelchair, seek accessible exits and call for assistance.";
      return "I'm still learning. Can you rephrase or try a suggestion?";
    }

    // display message
    function displayMessage(sender, text) {
      const box = document.getElementById("chatbox");
      box.innerHTML += `<p><strong>${sender}:</strong> ${text}</p>`;
      box.scrollTop = box.scrollHeight;
    }

    // send message
    function sendMessage() {
      const inputEl = document.getElementById("userInput");
      const text = inputEl.value.trim();
      if (!text) return;
      displayMessage("You", text);
      const reply = generateReply(text);
      displayMessage("Bot", reply);
      speak(reply);
      inputEl.value = "";
    }

    // suggestion helper
    function setSuggestion(text) {
      const inputEl = document.getElementById("userInput");
      inputEl.value = text;
      inputEl.focus();
    }

    // speech synthesis helper
    function speak(text) {
      try {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "en-US";
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      } catch (e) { console.warn("speak failed", e); }
    }

    // voice input for chat
    document.getElementById("voiceButton").addEventListener("click", function () {
      if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
        alert("Speech recognition not supported in this browser.");
        return;
      }
      const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const rec = new Recognition();
      rec.lang = "en-US";
      rec.interimResults = false;
      rec.start();
      rec.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("userInput").value = transcript;
        sendMessage();
      };
      rec.onerror = (e) => console.warn("voice chat error", e);
    });
  </script>
</body>
</html>
